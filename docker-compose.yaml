services:
  # 1. Metadata Database
  metastore-db:
    image: postgres:15
    container_name: hive-metastore-db
    environment:
      POSTGRES_DB: metastore_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: 2324
    networks:
      - trino-ranger-net

  # 2. Hive Metastore (HMS)
  hive-metastore:
      image: starburstdata/hive:3.1.2-e.18
      container_name: hive-metastore
      depends_on:
        - metastore-db
      environment:
        # Database connection
        HIVE_METASTORE_DRIVER: org.postgresql.Driver
        HIVE_METASTORE_JDBC_URL: jdbc:postgresql://hive-metastore-db:5432/metastore
        HIVE_METASTORE_USER: postgres
        HIVE_METASTORE_PASSWORD: 2324
        
        # S3 / MinIO Configuration (Pre-configured in this image)
        HIVE_METASTORE_WAREHOUSE_DIR: s3a://warehouse/
        S3_ENDPOINT: http://minio:9000
        S3_ACCESS_KEY: minioadmin
        S3_SECRET_KEY: minioadmin
        S3_PATH_STYLE_ACCESS: "true"
        REGION: "us-east-1"
        
        # LDAP / SSL Support (Optional but recommended for your environment)
        # If your LDAP requires a custom cert, you would add truststore opts here:
        # JAVA_TOOL_OPTIONS: "-Djavax.net.ssl.trustStore=/opt/hive/conf/truststore.jks -Djavax.net.ssl.trustStorePassword=changeit"

      ports:
        - "9083:9083"
      networks:
        - trino-ranger-net
        
networks:
  trino-ranger-net:
    external: true
    name: trino_engine_trino-ranger-net